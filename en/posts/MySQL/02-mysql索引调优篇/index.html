<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>ZhouJz&#39;s blog</title>
<meta name="keywords" content="">
<meta name="description" content="1. 索引的数据结构 为什么使用索引 索引时一种快速找到数据记录的数据结构，类比书的目录。 顺序查找磁盘I/O次数较多。 搜索树，减少了磁盘I/O次数。 索引优缺点 索引是什么 帮助MySQL高效获取数据的数据结构 索引在储存引擎中实现，不同的储存索引不一定完全一样。 优点 提高数据检索效率，降低数据I">
<meta name="author" content="ZhouJze">
<link rel="canonical" href="https://zhoujze.github.io/en/posts/mysql/02-mysql%E7%B4%A2%E5%BC%95%E8%B0%83%E4%BC%98%E7%AF%87/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.1d3401cbcdd2f10bdb5198bcf67bd24686c4792045e0991c052459ef4196f5cf.css" integrity="" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
        onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://zhoujze.github.io/img/Q.jpg">
<link rel="icon" type="image/png" sizes="16x16" href="https://zhoujze.github.io/img/Q.jpg">
<link rel="icon" type="image/png" sizes="32x32" href="https://zhoujze.github.io/img/Q.jpg">
<link rel="apple-touch-icon" href="https://zhoujze.github.io/Q.jpg">
<link rel="mask-icon" href="https://zhoujze.github.io/Q.jpg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="" />
<meta property="og:description" content="1. 索引的数据结构 为什么使用索引 索引时一种快速找到数据记录的数据结构，类比书的目录。 顺序查找磁盘I/O次数较多。 搜索树，减少了磁盘I/O次数。 索引优缺点 索引是什么 帮助MySQL高效获取数据的数据结构 索引在储存引擎中实现，不同的储存索引不一定完全一样。 优点 提高数据检索效率，降低数据I" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zhoujze.github.io/en/posts/mysql/02-mysql%E7%B4%A2%E5%BC%95%E8%B0%83%E4%BC%98%E7%AF%87/" /><meta property="article:section" content="posts" />



<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content=""/>
<meta name="twitter:description" content="1. 索引的数据结构 为什么使用索引 索引时一种快速找到数据记录的数据结构，类比书的目录。 顺序查找磁盘I/O次数较多。 搜索树，减少了磁盘I/O次数。 索引优缺点 索引是什么 帮助MySQL高效获取数据的数据结构 索引在储存引擎中实现，不同的储存索引不一定完全一样。 优点 提高数据检索效率，降低数据I"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "📚文章",
          "item": "https://zhoujze.github.io/en/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "",
      "item": "https://zhoujze.github.io/en/posts/mysql/02-mysql%E7%B4%A2%E5%BC%95%E8%B0%83%E4%BC%98%E7%AF%87/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "",
  "name": "",
  "description": "1. 索引的数据结构 为什么使用索引 索引时一种快速找到数据记录的数据结构，类比书的目录。 顺序查找磁盘I/O次数较多。 搜索树，减少了磁盘I/O次数。 索引优缺点 索引是什么 帮助MySQL高效获取数据的数据结构 索引在储存引擎中实现，不同的储存索引不一定完全一样。 优点 提高数据检索效率，降低数据I",
  "keywords": [
    
  ],
  "articleBody": "1. 索引的数据结构 为什么使用索引 索引时一种快速找到数据记录的数据结构，类比书的目录。\n顺序查找磁盘I/O次数较多。\n搜索树，减少了磁盘I/O次数。\n索引优缺点 索引是什么 帮助MySQL高效获取数据的数据结构\n索引在储存引擎中实现，不同的储存索引不一定完全一样。\n优点 提高数据检索效率，降低数据IO成本 通过创建唯一索引，可以保证数据的唯一性 加速表与表中间的连接，如父子表联合查询 减少查询中的分组和排序时间 缺点 索引需要创建和维护，耗费时间 索引也要占用磁盘空间 提高查询速度，但是降低了增删改的速度。因为更新需要维护索引。 对于3问题，最好先删除索引。然后插入数据，完成后再创建索引。\nInnoDB中索引的推演 索引之前的查找 在一页内查找 假设目前表中的记录比较少，所有的记录都可以被存放在一个页中，在查找记录的时候可以根据搜索条件的不同分为两种情况：\n以主键为搜索条件：页目录中使用二分法快速定位对应槽，遍历槽对应分组中记录。 以其他列作为搜索条件：因数据页中没有对非主键简历页目录。通过最小记录依次遍历，找到。 在很多页查找 记录很多，有两步：\n定位到所在页 在所在页查找相应记录 没有索引的情况下，需要从头把数据页加载到内存然后依次遍历找到，耗时耗力。\n设计索引 简单索引方案 建表：\nCREATE TABLE index_demo( c1 INT, c2 INT, c3 CHAR(1), PRIMARY KEY(c1) ) ROW_FORMAT = COMPACT; 表示意图： record_type：记录类型，0普通记录，1目录记录，2最小记录，3最大记录。 next_record：指针，指向下一个记录。 添加记录：\n在原始数据1，3，5后添加主键为4的数据，因为主键递增。所以4，5互换位置，称为页分裂\n给所有的页简历目录项 因为数据页编号不连续，所以要找到记录需要遍历整个数据\n为数据页编号设置目录项\nkey：为页中最小的主键值 page_no：页号 目录项称为索引。\nInnDB中索引方案 迭代1次-目录项记录的页 目录项记录和普通用户记录区别：\nrecord_type目录项记录为1，普通为2 目录项记录页只有两项，普通由用户定义 （了解）记录头信息中有min_rec_mask属性，只有目录项记录页中为1，别的都为0 相同点：\n都是同样的数据页，都用页目录，都可以用二分加快查找速度 迭代2次-多个目录项记录的页 IO最多加载很多次。\n迭代3次-目录项记录页的目录页 IO最多加载3次。\n用图来描述\n这个数据结构，称为B+树。\nB+树通常不超过4层\n原因：层数越低，IO次数越少。4层所容纳的记录很庞大，4层以上没有必要。\n常见索引概念 聚簇索引 据此索引不是单独的索引类型，而是一种数据存储方式，所有用户记录保存在叶子节点，所谓索引即数据，数据即索引。\n特点：\n记录和页排序方向： 页内：按主键大小顺序排成单向链表 用户记录页：按页内主键大小顺序排成双向链表 目录项记录页：页内外都是通过主键大小顺序排成双向链表 叶子节点存储完整的用户数据 添加数据的时候，底层自动构建聚簇索引\n优点：\n数据访问更快 主键排序查找和范围查找速度块 节省大量IO操作 缺点：\n插入速度严重依赖于插入顺序 更新主键值代价很高 二级索引需要两次索引查找，第一次找主键，第二次找数据 限制：\n只有InnDB支持聚簇索引 如没有定义主键，InnDB会选择非空的唯一索引代替，如果没有InnDB会隐式定义一个主键。 InnDB表主键尽量选用有序的顺序Id，不建议用无需，无法宝珠主键数据的顺序长度。 二级索引（辅助索引、非聚簇索引） 非主键字段做索引，把主键做记录，对每个非主键字段都做一次索引。\n在通过非主键查询整个记录的时候，再通过查找到的c1主键回到聚簇索引查找其他字段的操作叫回表。\n聚簇索引于非聚簇索引原理不同，使用也有区别：\n聚簇索引的叶子节点存储的是数据记录，非聚簇索引叶子节点是数据位置，非聚簇索引不会影响数据表的物理存储顺序。 一个表只能由一个聚簇索引，因为只能有一种排序储存的方式，但是可以有多个非聚簇索引，也就是多个索引目录提供数据检索。 使用聚簇索引，数据查询效率高，但是插入、删除、更新操作效率比非聚簇索引低。 联合索引 两个字段进行联合索引，在c2相同的时候，按照c3的顺序排列。\nInnoDB的B+树索引的注意事项 根位置万年不动 在实际的B+树生成过程中是由上而下创建的。\n最初的时候只有一层根页面。 插入数据，当跟页面空间用完的时候，对根页面中的数据复制到新的数据页A内，然后对新页A进行页分裂得到新页B，这时新插入的数据根据顺序插入到新页A或者新页B。最后把根页面升级为存储目录项记录的页。 根节点从始至终都存在，不会移动。\n内节点中目录项记录的唯一性 在非聚簇索引中举例：\n构建二级索引：\n当要插入新数据：c1：9、c2：1、c3：‘p’的时候，我们无法判断是在页4添加还是页5添加。没法保持唯一性。\n解决办法把主键添加进去：\n这样通过c1和c2就可以唯一的确定位置。\n一个页面最少存储2条记录 一个B+树只需要很少的层级就可以轻松存储数亿条记录，查询速度很快。\nMyISAM中的索引方案 Memory默认采用Hash索引。MyISAM和InnoDB默认采用B+树索引。\nMyISAM引擎使用B+树作为索引结构，叶子节点的data域存放数据记录的地址值\nMyISAM索引的原理 MyISAM数据和索引分开存储。\n原理图：\n在Col2上建立一个二级索引，则此索引的结构如下图所示： MyISAM与InnoDB对比 MyISAM中索引方式都是非聚簇的，与InnoDB包含1个聚簇索引是不同的\nInnoDB中需要根据主键值对聚簇索引进行一次查找就能找到记录，MyISAM中却需要进行一次回表操作，所以MyISAM中的索引都是二级索引。 InnoDB数据本身也是索引，MyISAM中索引文件和数据文件分开存储，索引仅存储数据地址值。 InnoDB的非聚簇索引data域存储相应的主键值，而MyISAM索引记录的是地址。 MyISAM因为data域存储的是地址值，所以在进行回表操作的时候非常快。InnoDB则需要先获取主键，然后再去聚簇索引里找记录，没有MyISAM迅速。 InnoDB要求必须有主键，而MyISAM可以没有，如果没有，MySQL洗头膏会自动选择一个字段做主键，如果不存在符合条件的字段，则生成隐含字段做主键。 索引的代价 空间上的代价\n只要创建索引，就会创建数据页，一个页默认16KB，会占用很大一片存储空间\n时间上的代价\n每次对表中数据进行增删改，都要去修改B+树索引，增加了维护B+树的时间成本。\n一个表上索引越多，占用空间就越大，增删改性能就越差，索引我们要学会在哪些地方合理的使用索引。\nMySQL数据结构选择的合理性 归根结底就是减少对磁盘I/O的操作次数，提升效率。\n全表遍历 顺序遍历查找\nHash结构 Hash本身是一个函数，又称散列函数，可以帮助我们大幅提升检索数据效率\n相同的输入永远可以得到相同的输出。\nHash结构效率高，那为什么索引要设计成树\n原因1：Hash索引只能满足等值查询，对范围查询时间复杂度还是O(n)\n原因2：Hash索引数据的存储是没有顺序的，在Order by情况下，使用Hash索引还需要进行排序\n原因3：对于联合查询，hash值相加有可能出现相同的情况\n原因4：对于等值查询，如果出现类似性别的情况，重复太多，那么hash碰撞就很频繁。\nHash索引的适用性：\n采用自适应 Hash 索引目的是方便根据 SQL 的查询条件加速定位到叶子节点，特别是当 B+ 树比较深的时候，通过自适应 Hash 索引可以明显提高数据的检索效率。\n二叉搜索树 极端情况\n时间复杂度退化到了O(n)。\nAVL树 又称平衡二叉树。左右节点高度差不超过1\n针对同样的数据，如果我们把二叉树改成M 叉树（M\u003e2）呢？当 M=3 时，同样的 31 个节点可以由下面的三叉树来进行存储：\n为了提高查询效率，就需要减少磁盘IO数。为了减少磁盘IO的次数，就需要尽量降低树的高度，需要把原来“瘦高”的树结构变的“矮胖”，树的每层的分叉越多越好。\nB-Tree 结构图：\nB 树相比于平衡二叉树来说磁盘 I/O 操作要少，在数据查询中比平衡二叉树效率要高。所以只要树的高度足够低，IO次数足够少，就可以提高查询性能。\n举例1：\nB+Tree 基于B树做出了改进，更适合文件索引系统。\nB+树与B树的差异：\n有k个孩子节点就有k个关键字，孩子数=关键字数，而B数，孩子数=关键字数+1 非叶子节点的关键字也会存在在叶子节点，并且是在子节点中所有关键字的最大或最小 非叶子节点仅用于索引，不保存数据记录，跟记录有关的信息都放在叶子节点。B树中，非叶子节点既保存数据又保存索引。 所有关键字都在叶子节点出现，叶子节点构成双向有序链表，叶子节点本身按照关键字大小从小到大顺序链接。 思考\n为了减少IO，索引会一次性加载吗？\n数据库索引是储存在磁盘上的，如果数据量很大，必然导致索引很大。 当我们利用索引查询时，不可能全部加载，只能逐一加载每个磁盘页，因为磁盘页对应着索引树的节点。 B+树能力如何，为什么说一般查找行记录，只要1-3次磁盘IO\nB+树中储存页标准16kb，我们主键INT为4字节，BIGINT为8字节，指针类型一般也为4-8字节。那么一个储存也就可以存储16kb/(8b+8b)=1k个键值，估算下来如果B+树为3层结构，那么就是1k * 1k * 1k = 10亿条记录，非常庞大。 实际情况每个节点不一定填满，因此B+树高度一般为2-4层，所以如果有4层那么第四层到根节点最多也就3次IO。 为什么说B+树比B-树更适合实际应用中操作系统的文件索引和数据库索引？\nB+树磁盘读写代价更低 B+树的查询效率更加稳定 R树 了解\n2. InnoDB数据存储结构 数据库的储存结构：页 索引储存在页结构里，索引是在储存引擎中实现的。不同引擎存放格式不同。\nInnoDB是MySQL默认存储引擎。\n磁盘与内存交互基本单位：页 InnoDB将数据划分为若干个页，InnoDB中页的大小默认为16KB\n页是磁盘与内存之间交互的基本单位。一次最少从磁盘中读取16KB内容到内存中。一次最少把内存中的16KB内容刷新到磁盘中。\n数据库管理存储空间的基本单位是页（Page），数据库I/O操作的最小单位是页。\n页结构概述 页不在物理结构上相连，只需通过双向链表关联即可。\n数据页中每条记录按照主键值从小到大顺序组成单向链表。\n每个数据页都会储存的记录生成页目录。\n通过主键查找记录，可以在页目录中使用二分法快速定位。\n页的大小 在MySQL的InnoDB引擎中，默认页大小为16KB。\n页的上层结构 页的上层结构有区、段、表空间。\n区：比页大一级，一个区分配64个连续页，区大小为64*16KB=1MB 段：由一个或多个连续区组成，区是连续分配的空间。段时数据库中的分配单位，不同类型的数据库对象以不同的段形式存在。 表空间：一个表空间可以有一个或多个段。表空间从管理上可以划分为系统表空间、用户表空间、撤销表空间、临时表空间 等。 页的内部结构 常见：数据页（保存B+树节点） 、系统页、Undo页和事务数据页\n数据页被分为7个部分：\n7部分作用：\n第一部分：File Header（文件头）和File Trailer（文件尾） 文件头部（38字节） 作用： 描述各种页的通用信息（如页编号、下一页信息）\n名称 占用空间大小 描述 FIL_PAGE_SPACE_OR_CHKSUM 4字节 页的校验和（checksum值） FIL_PAGE_OFFSET 4字节 页号 FIL_PAGE_PREV 4字节 上一个页的页号 FIL_PAGE_NEXT 4字节 下一个页的页号 FIL_PAGE_LSN 8字节 页面被最后修改时对应的日志序列位置 FIL_PAGE_TYPE 2字节 该页的类型 FIL_PAGE_FILE_FLUSH_LSN 8字节 仅在系统表空间的一个页中定义，代表文件至少被刷新到了对应的LSN值 FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID 4字节 页属于哪个表空间 FIL_PAGE_OFFSET：记录页的编号。\nFIL_PAGE_TYPE：当前页类型。如下：\n类型名称 十六进制 描述 FIL_PAGE_TYPE_ALLOCATED 0x0000 最新分配，还没有使用 FIL_PAGE_UNDO_LOG 0x0002 Undo日志页 FIL_PAGE_INODE 0x0003 段信息节点 FIL_PAGE_IBUF_FREE_LIST 0x0004 Insert Buffer空闲列表 FIL_PAGE_IBUF_BITMAP 0x0005 Insert Buffer位图 FIL_PAGE_TYPE_SYS 0x0006 系统页 FIL_PAGE_TYPE_TRX_SYS 0x0007 事务系统数据 FIL_PAGE_TYPE_FSP_HDR 0x0008 表空间头部信息 FIL_PAGE_TYPE_XDES 0x0009 扩展描述页 FIL_PAGE_TYPE_BLOB 0x000A 溢出页 FIL_PAGE_INDEX 0x45BF 索引页，也就是我们所说的数据页 第二部分：空闲空间、用户记录和最小最大记录 3. 索引的创建与设计原则 3.1 索引的声明与使用 索引的分类 功能逻辑：普通索引、唯一索引、主键索引、全文索引 物理实现方式：聚簇索引、非聚簇索引 作用字段：单列索引、联合索引 不同存储引擎支持的索引类型不一样\n创建索引 1）在建表的时候创建索引 CREATE TABLE dept( dept_id INT PRIMARY KEY AUTO_INCREMENT, #主键索引 dept_name VARCHAR(20) ); CREATE TABLE emp( emp_id INT PRIMARY KEY AUTO_INCREMENT, emp_name VARCHAR(20) UNIQUE, #唯一索引 dept_id INT, CONSTRAINT emp_dept_id_fk FOREIGN KEY(dept_id) REFERENCES dept(dept_id) #外键索引 ); 显示创表时创建索引，基础语法\nCREATE TABLE table_name [col_name data_type] [UNIQUE | FULLTEXT | SPATIAL] [INDEX | KEY] [index_name] (col_name [length]) [ASC | DESC] UNIQUE、FULLTEXT和SPATIAL为可选参数，分别表示唯一索引、全文索引和空间索引； INDEX 与 KEY 为同义词，两者的作用相同，用来指定创建索引； index_name 指定索引的名称，为可选参数，如果不指定，那么MySQL默认col_name为索引名； col_name 为需要创建索引的字段列，该列必须从数据表中定义的多个列中选择； length为可选参数，表示索引的长度，只有字符串类型的字段才能指定索引长度； ASC 或 DESC 指定升序或者降序的索引值存储。 2）创建普通索引 CREATE TABLE book( book_id INT , book_name VARCHAR(100), `authors` VARCHAR(100), info VARCHAR(100) , `comment` VARCHAR(100), year_publication YEAR, INDEX(year_publication) #普通索引 ); 3）创建唯一索引 CREATE TABLE test1( id INT NOT NULL, NAME VARCHAR(30) NOT NULL, UNIQUE INDEX uk_idx_id(id) #使用id作为唯一索引 ); 使用SHOW CREATE TABLE查看表结构\nSHOW INDEX FROM test1; 4）主键索引 设定为主键后数据库自动建立索引，innodb为聚簇索引\nCREATE TABLE student ( id INT(10) UNSIGNED AUTO_INCREMENT , student_no VARCHAR(200), student_name VARCHAR(200), PRIMARY KEY(id) ); SHOW INDEX FROM student; 删除主键索引\nALTER TABLE student DROP PRIMARY KEY; 有概率会出现特殊情况\n因主键有自动递增，需要先删除自动递增约束\nALTER TABLE student MODIFY id INT(10) UNSIGNED; ALTER TABLE student DROP PRIMARY KEY; 4. 性能分析工具的使用 5. 索引优化与查询优化 6. 数据库设计规范 7. 数据库其它调优策略 ",
  "wordCount" : "5419",
  "inLanguage": "en",
  "datePublished": "0001-01-01T00:00:00Z",
  "dateModified": "0001-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "ZhouJze"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://zhoujze.github.io/en/posts/mysql/02-mysql%E7%B4%A2%E5%BC%95%E8%B0%83%E4%BC%98%E7%AF%87/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "ZhouJz's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://zhoujze.github.io/img/Q.jpg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://zhoujze.github.io/en/" accesskey="h" title="ZhouJze&#39;s Blog (Alt + H)">
            <img src="https://zhoujze.github.io/img/Q.jpg" alt="logo" aria-label="logo"
                 height="35">ZhouJze&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://zhoujze.github.io/en/search" title="🔍搜索 (Alt &#43; /)" accesskey=/>
                <span>🔍搜索</span>
                </a>
            </li>
            <li>
                <a href="https://zhoujze.github.io/en/" title="🏠主页">
                <span>🏠主页</span>
                </a>
            </li>
            <li>
                <a href="https://zhoujze.github.io/en/archives/" title="⏱时间轴">
                <span>⏱时间轴</span>
                </a>
            </li>
            <li>
                <a href="https://zhoujze.github.io/en/tags" title="🔖标签">
                <span>🔖标签</span>
                </a>
            </li>
            <li>
                <a href="https://zhoujze.github.io/en/about" title="🙋🏻‍♂️关于">
                <span>🙋🏻‍♂️关于</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://zhoujze.github.io/en/">🏠 主页</a>&nbsp;»&nbsp;<a href="https://zhoujze.github.io/en/posts/">📚文章</a></div>
            <h1 class="post-title">
                
            </h1>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>0001-01-01
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>5419字
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>11分钟
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>ZhouJze
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    <span id="post_meta_style_8">
                        <span class="fa fa-commenting-o"></span>
                        <span>
                            <script src="https://cdn.staticfile.org/twikoo/1.4.11/twikoo.all.min.js"></script>
                            <script>
                                let url = document.documentURI
                                
                                let dnsUrl = "https://zhoujze.github.io/"
                                let urlSplit = url.split(dnsUrl)
                                let finalUrl = urlSplit[1]
                                if (finalUrl[0] !== '/') {
                                    finalUrl = '/'+finalUrl
                                }
                                twikoo.getCommentsCount({
                                    envId:  null , 
                                region:  null , 
                                urls: [ 
                                    
                                    finalUrl,
                                ],
                                    includeReply: false 
                                }).then(function (res) {
                                    let count = res[0].count
                                    const obj = document.getElementById("comment_count");
                                    obj.innerText = count
                                    
                                    
                                    
                                }).catch(function (err) {
                                    
                                    console.error(err);
                                });
                            </script>
                            <span id="comment_count"></span>
                        </span>
                    </span>
                </span>

</div>
        </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">文章目录</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#1-%e7%b4%a2%e5%bc%95%e7%9a%84%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84" aria-label="1. 索引的数据结构">1. 索引的数据结构</a><ul>
                        
                <li>
                    <a href="#%e4%b8%ba%e4%bb%80%e4%b9%88%e4%bd%bf%e7%94%a8%e7%b4%a2%e5%bc%95" aria-label="为什么使用索引">为什么使用索引</a></li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e4%bc%98%e7%bc%ba%e7%82%b9" aria-label="索引优缺点">索引优缺点</a><ul>
                        
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e6%98%af%e4%bb%80%e4%b9%88" aria-label="索引是什么">索引是什么</a></li>
                <li>
                    <a href="#%e4%bc%98%e7%82%b9" aria-label="优点">优点</a></li>
                <li>
                    <a href="#%e7%bc%ba%e7%82%b9" aria-label="缺点">缺点</a></li></ul>
                </li>
                <li>
                    <a href="#innodb%e4%b8%ad%e7%b4%a2%e5%bc%95%e7%9a%84%e6%8e%a8%e6%bc%94" aria-label="InnoDB中索引的推演">InnoDB中索引的推演</a><ul>
                        
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e4%b9%8b%e5%89%8d%e7%9a%84%e6%9f%a5%e6%89%be" aria-label="索引之前的查找">索引之前的查找</a><ul>
                        
                <li>
                    <a href="#%e5%9c%a8%e4%b8%80%e9%a1%b5%e5%86%85%e6%9f%a5%e6%89%be" aria-label="在一页内查找">在一页内查找</a></li>
                <li>
                    <a href="#%e5%9c%a8%e5%be%88%e5%a4%9a%e9%a1%b5%e6%9f%a5%e6%89%be" aria-label="在很多页查找">在很多页查找</a></li></ul>
                </li>
                <li>
                    <a href="#%e8%ae%be%e8%ae%a1%e7%b4%a2%e5%bc%95" aria-label="设计索引">设计索引</a><ul>
                        
                <li>
                    <a href="#%e7%ae%80%e5%8d%95%e7%b4%a2%e5%bc%95%e6%96%b9%e6%a1%88" aria-label="简单索引方案">简单索引方案</a></li>
                <li>
                    <a href="#inndb%e4%b8%ad%e7%b4%a2%e5%bc%95%e6%96%b9%e6%a1%88" aria-label="InnDB中索引方案">InnDB中索引方案</a><ul>
                        
                <li>
                    <a href="#%e8%bf%ad%e4%bb%a31%e6%ac%a1-%e7%9b%ae%e5%bd%95%e9%a1%b9%e8%ae%b0%e5%bd%95%e7%9a%84%e9%a1%b5" aria-label="迭代1次-目录项记录的页">迭代1次-目录项记录的页</a></li>
                <li>
                    <a href="#%e8%bf%ad%e4%bb%a32%e6%ac%a1-%e5%a4%9a%e4%b8%aa%e7%9b%ae%e5%bd%95%e9%a1%b9%e8%ae%b0%e5%bd%95%e7%9a%84%e9%a1%b5" aria-label="迭代2次-多个目录项记录的页">迭代2次-多个目录项记录的页</a></li>
                <li>
                    <a href="#%e8%bf%ad%e4%bb%a33%e6%ac%a1-%e7%9b%ae%e5%bd%95%e9%a1%b9%e8%ae%b0%e5%bd%95%e9%a1%b5%e7%9a%84%e7%9b%ae%e5%bd%95%e9%a1%b5" aria-label="迭代3次-目录项记录页的目录页">迭代3次-目录项记录页的目录页</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#%e5%b8%b8%e8%a7%81%e7%b4%a2%e5%bc%95%e6%a6%82%e5%bf%b5" aria-label="常见索引概念">常见索引概念</a><ul>
                        
                <li>
                    <a href="#%e8%81%9a%e7%b0%87%e7%b4%a2%e5%bc%95" aria-label="聚簇索引">聚簇索引</a></li>
                <li>
                    <a href="#%e4%ba%8c%e7%ba%a7%e7%b4%a2%e5%bc%95%e8%be%85%e5%8a%a9%e7%b4%a2%e5%bc%95%e9%9d%9e%e8%81%9a%e7%b0%87%e7%b4%a2%e5%bc%95" aria-label="二级索引（辅助索引、非聚簇索引）">二级索引（辅助索引、非聚簇索引）</a></li>
                <li>
                    <a href="#%e8%81%94%e5%90%88%e7%b4%a2%e5%bc%95" aria-label="联合索引">联合索引</a></li></ul>
                </li>
                <li>
                    <a href="#innodb%e7%9a%84b%e6%a0%91%e7%b4%a2%e5%bc%95%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" aria-label="InnoDB的B&#43;树索引的注意事项">InnoDB的B+树索引的注意事项</a><ul>
                        
                <li>
                    <a href="#%e6%a0%b9%e4%bd%8d%e7%bd%ae%e4%b8%87%e5%b9%b4%e4%b8%8d%e5%8a%a8" aria-label="根位置万年不动">根位置万年不动</a></li>
                <li>
                    <a href="#%e5%86%85%e8%8a%82%e7%82%b9%e4%b8%ad%e7%9b%ae%e5%bd%95%e9%a1%b9%e8%ae%b0%e5%bd%95%e7%9a%84%e5%94%af%e4%b8%80%e6%80%a7" aria-label="内节点中目录项记录的唯一性">内节点中目录项记录的唯一性</a></li>
                <li>
                    <a href="#%e4%b8%80%e4%b8%aa%e9%a1%b5%e9%9d%a2%e6%9c%80%e5%b0%91%e5%ad%98%e5%82%a82%e6%9d%a1%e8%ae%b0%e5%bd%95" aria-label="一个页面最少存储2条记录">一个页面最少存储2条记录</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#myisam%e4%b8%ad%e7%9a%84%e7%b4%a2%e5%bc%95%e6%96%b9%e6%a1%88" aria-label="MyISAM中的索引方案">MyISAM中的索引方案</a><ul>
                        
                <li>
                    <a href="#myisam%e7%b4%a2%e5%bc%95%e7%9a%84%e5%8e%9f%e7%90%86" aria-label="MyISAM索引的原理">MyISAM索引的原理</a></li>
                <li>
                    <a href="#myisam%e4%b8%8einnodb%e5%af%b9%e6%af%94" aria-label="MyISAM与InnoDB对比">MyISAM与InnoDB对比</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e7%9a%84%e4%bb%a3%e4%bb%b7" aria-label="索引的代价">索引的代价</a></li>
                <li>
                    <a href="#mysql%e6%95%b0%e6%8d%ae%e7%bb%93%e6%9e%84%e9%80%89%e6%8b%a9%e7%9a%84%e5%90%88%e7%90%86%e6%80%a7" aria-label="MySQL数据结构选择的合理性">MySQL数据结构选择的合理性</a><ul>
                        
                <li>
                    <a href="#%e5%85%a8%e8%a1%a8%e9%81%8d%e5%8e%86" aria-label="全表遍历">全表遍历</a></li>
                <li>
                    <a href="#hash%e7%bb%93%e6%9e%84" aria-label="Hash结构">Hash结构</a></li>
                <li>
                    <a href="#%e4%ba%8c%e5%8f%89%e6%90%9c%e7%b4%a2%e6%a0%91" aria-label="二叉搜索树">二叉搜索树</a></li>
                <li>
                    <a href="#avl%e6%a0%91" aria-label="AVL树">AVL树</a></li>
                <li>
                    <a href="#b-tree" aria-label="B-Tree">B-Tree</a></li>
                <li>
                    <a href="#btree" aria-label="B&#43;Tree">B+Tree</a></li>
                <li>
                    <a href="#r%e6%a0%91" aria-label="R树">R树</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#2-innodb%e6%95%b0%e6%8d%ae%e5%ad%98%e5%82%a8%e7%bb%93%e6%9e%84" aria-label="2. InnoDB数据存储结构">2. InnoDB数据存储结构</a><ul>
                        
                <li>
                    <a href="#%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e5%82%a8%e5%ad%98%e7%bb%93%e6%9e%84%e9%a1%b5" aria-label="数据库的储存结构：页">数据库的储存结构：页</a><ul>
                        
                <li>
                    <a href="#%e7%a3%81%e7%9b%98%e4%b8%8e%e5%86%85%e5%ad%98%e4%ba%a4%e4%ba%92%e5%9f%ba%e6%9c%ac%e5%8d%95%e4%bd%8d%e9%a1%b5" aria-label="磁盘与内存交互基本单位：页">磁盘与内存交互基本单位：页</a></li>
                <li>
                    <a href="#%e9%a1%b5%e7%bb%93%e6%9e%84%e6%a6%82%e8%bf%b0" aria-label="页结构概述">页结构概述</a></li>
                <li>
                    <a href="#%e9%a1%b5%e7%9a%84%e5%a4%a7%e5%b0%8f" aria-label="页的大小">页的大小</a></li>
                <li>
                    <a href="#%e9%a1%b5%e7%9a%84%e4%b8%8a%e5%b1%82%e7%bb%93%e6%9e%84" aria-label="页的上层结构">页的上层结构</a></li></ul>
                </li>
                <li>
                    <a href="#%e9%a1%b5%e7%9a%84%e5%86%85%e9%83%a8%e7%bb%93%e6%9e%84" aria-label="页的内部结构">页的内部结构</a><ul>
                        
                <li>
                    <a href="#%e7%ac%ac%e4%b8%80%e9%83%a8%e5%88%86file-header%e6%96%87%e4%bb%b6%e5%a4%b4%e5%92%8cfile-trailer%e6%96%87%e4%bb%b6%e5%b0%be" aria-label="第一部分：File Header（文件头）和File Trailer（文件尾）">第一部分：File Header（文件头）和File Trailer（文件尾）</a><ul>
                        
                <li>
                    <a href="#%e6%96%87%e4%bb%b6%e5%a4%b4%e9%83%a838%e5%ad%97%e8%8a%82" aria-label="文件头部（38字节）">文件头部（38字节）</a></li></ul>
                </li>
                <li>
                    <a href="#%e7%ac%ac%e4%ba%8c%e9%83%a8%e5%88%86%e7%a9%ba%e9%97%b2%e7%a9%ba%e9%97%b4%e7%94%a8%e6%88%b7%e8%ae%b0%e5%bd%95%e5%92%8c%e6%9c%80%e5%b0%8f%e6%9c%80%e5%a4%a7%e8%ae%b0%e5%bd%95" aria-label="第二部分：空闲空间、用户记录和最小最大记录">第二部分：空闲空间、用户记录和最小最大记录</a></li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#3-%e7%b4%a2%e5%bc%95%e7%9a%84%e5%88%9b%e5%bb%ba%e4%b8%8e%e8%ae%be%e8%ae%a1%e5%8e%9f%e5%88%99" aria-label="3. 索引的创建与设计原则">3. 索引的创建与设计原则</a><ul>
                        
                <li>
                    <a href="#31-%e7%b4%a2%e5%bc%95%e7%9a%84%e5%a3%b0%e6%98%8e%e4%b8%8e%e4%bd%bf%e7%94%a8" aria-label="3.1 索引的声明与使用">3.1 索引的声明与使用</a><ul>
                        
                <li>
                    <a href="#%e7%b4%a2%e5%bc%95%e7%9a%84%e5%88%86%e7%b1%bb" aria-label="索引的分类">索引的分类</a></li>
                <li>
                    <a href="#%e5%88%9b%e5%bb%ba%e7%b4%a2%e5%bc%95" aria-label="创建索引">创建索引</a><ul>
                        
                <li>
                    <a href="#1%e5%9c%a8%e5%bb%ba%e8%a1%a8%e7%9a%84%e6%97%b6%e5%80%99%e5%88%9b%e5%bb%ba%e7%b4%a2%e5%bc%95" aria-label="1）在建表的时候创建索引">1）在建表的时候创建索引</a></li>
                <li>
                    <a href="#2%e5%88%9b%e5%bb%ba%e6%99%ae%e9%80%9a%e7%b4%a2%e5%bc%95" aria-label="2）创建普通索引">2）创建普通索引</a></li>
                <li>
                    <a href="#3%e5%88%9b%e5%bb%ba%e5%94%af%e4%b8%80%e7%b4%a2%e5%bc%95" aria-label="3）创建唯一索引">3）创建唯一索引</a></li>
                <li>
                    <a href="#4%e4%b8%bb%e9%94%ae%e7%b4%a2%e5%bc%95" aria-label="4）主键索引">4）主键索引</a></li></ul>
                </li></ul>
                </li></ul>
                </li>
                <li>
                    <a href="#4-%e6%80%a7%e8%83%bd%e5%88%86%e6%9e%90%e5%b7%a5%e5%85%b7%e7%9a%84%e4%bd%bf%e7%94%a8" aria-label="4. 性能分析工具的使用">4. 性能分析工具的使用</a></li>
                <li>
                    <a href="#5-%e7%b4%a2%e5%bc%95%e4%bc%98%e5%8c%96%e4%b8%8e%e6%9f%a5%e8%af%a2%e4%bc%98%e5%8c%96" aria-label="5. 索引优化与查询优化">5. 索引优化与查询优化</a></li>
                <li>
                    <a href="#6-%e6%95%b0%e6%8d%ae%e5%ba%93%e8%ae%be%e8%ae%a1%e8%a7%84%e8%8c%83" aria-label="6. 数据库设计规范">6. 数据库设计规范</a></li>
                <li>
                    <a href="#7-%e6%95%b0%e6%8d%ae%e5%ba%93%e5%85%b6%e5%ae%83%e8%b0%83%e4%bc%98%e7%ad%96%e7%95%a5" aria-label="7. 数据库其它调优策略">7. 数据库其它调优策略</a>
                </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        if (elements) {
            activeElement = Array.from(elements).find((element) => {
                if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                    (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                    return element;
                }
            }) || activeElement

            elements.forEach(element => {
                const id = encodeURI(element.getAttribute('id')).toLowerCase();
                if (element === activeElement){
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
                } else {
                    document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
                }
            })
        }
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h1 id="1-索引的数据结构">1. 索引的数据结构<a hidden class="anchor" aria-hidden="true" href="#1-索引的数据结构">#</a></h1>
<h2 id="为什么使用索引">为什么使用索引<a hidden class="anchor" aria-hidden="true" href="#为什么使用索引">#</a></h2>
<p>索引时一种快速找到数据记录的数据结构，类比书的目录。</p>
<p><img loading="lazy" src="image.png" alt="顺序搜索索引"  />
</p>
<p>顺序查找磁盘I/O次数较多。</p>
<p><img loading="lazy" src="image-1.png" alt="使用二叉搜索树"  />
</p>
<p>搜索树，减少了磁盘I/O次数。</p>
<h2 id="索引优缺点">索引优缺点<a hidden class="anchor" aria-hidden="true" href="#索引优缺点">#</a></h2>
<h3 id="索引是什么">索引是什么<a hidden class="anchor" aria-hidden="true" href="#索引是什么">#</a></h3>
<p>帮助MySQL高效获取数据的数据结构</p>
<p>索引在储存引擎中实现，不同的储存索引不一定完全一样。</p>
<h3 id="优点">优点<a hidden class="anchor" aria-hidden="true" href="#优点">#</a></h3>
<ol>
<li>提高数据检索效率，降低数据IO成本</li>
<li>通过创建唯一索引，可以保证数据的唯一性</li>
<li>加速表与表中间的连接，如父子表联合查询</li>
<li>减少查询中的分组和排序时间</li>
</ol>
<h3 id="缺点">缺点<a hidden class="anchor" aria-hidden="true" href="#缺点">#</a></h3>
<ol>
<li>索引需要创建和维护，耗费时间</li>
<li>索引也要占用磁盘空间</li>
<li>提高查询速度，但是降低了增删改的速度。因为更新需要维护索引。</li>
</ol>
<blockquote>
<p>对于3问题，最好先删除索引。然后插入数据，完成后再创建索引。</p>
</blockquote>
<h2 id="innodb中索引的推演">InnoDB中索引的推演<a hidden class="anchor" aria-hidden="true" href="#innodb中索引的推演">#</a></h2>
<h3 id="索引之前的查找">索引之前的查找<a hidden class="anchor" aria-hidden="true" href="#索引之前的查找">#</a></h3>
<h4 id="在一页内查找">在一页内查找<a hidden class="anchor" aria-hidden="true" href="#在一页内查找">#</a></h4>
<p>假设目前表中的记录比较少，所有的记录都可以被存放在一个页中，在查找记录的时候可以根据搜索条件的不同分为两种情况：</p>
<ol>
<li>以主键为搜索条件：页目录中使用<strong>二分法</strong>快速定位对应槽，遍历槽对应分组中记录。</li>
<li>以其他列作为搜索条件：因数据页中没有对非主键简历页目录。通过最小记录依次遍历，找到。</li>
</ol>
<h4 id="在很多页查找">在很多页查找<a hidden class="anchor" aria-hidden="true" href="#在很多页查找">#</a></h4>
<p>记录很多，有两步：</p>
<ol>
<li>定位到所在页</li>
<li>在所在页查找相应记录</li>
</ol>
<p><strong>没有索引的情况下，需要从头把数据页加载到内存然后依次遍历找到，耗时耗力。</strong></p>
<h3 id="设计索引">设计索引<a hidden class="anchor" aria-hidden="true" href="#设计索引">#</a></h3>
<h4 id="简单索引方案">简单索引方案<a hidden class="anchor" aria-hidden="true" href="#简单索引方案">#</a></h4>
<p>建表：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> index_demo(
</span></span><span style="display:flex;"><span>    c1 INT,
</span></span><span style="display:flex;"><span>    c2 INT,
</span></span><span style="display:flex;"><span>    c3 CHAR(<span style="color:#ae81ff">1</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(c1)
</span></span><span style="display:flex;"><span>) ROW_FORMAT <span style="color:#f92672">=</span> COMPACT;
</span></span></code></pre></div><p>表示意图：
<img loading="lazy" src="image-2.png" alt="建表示意图"  />
</p>
<ul>
<li><code>record_type</code>：记录类型，<code>0</code>普通记录，<code>1</code>目录记录，<code>2</code>最小记录，<code>3</code>最大记录。</li>
<li><code>next_record</code>：指针，指向下一个记录。</li>
</ul>
<p><img loading="lazy" src="image-3.png" alt="建表竖向图"  />
</p>
<p><img loading="lazy" src="image-4.png" alt="数据示意图"  />
</p>
<p>添加记录：</p>
<p><img loading="lazy" src="image-5.png" alt="页分裂"  />
</p>
<p>在原始数据1，3，5后添加主键为4的数据，因为主键递增。所以4，5互换位置，称为<strong>页分裂</strong></p>
<ul>
<li>给所有的页简历目录项</li>
</ul>
<p>因为数据页编号不连续，所以要找到记录需要遍历整个数据</p>
<p><img loading="lazy" src="image-6.png" alt="数据页不连续"  />
</p>
<p>为数据页编号设置目录项</p>
<p><img loading="lazy" src="image-7.png" alt="为数据页编号设置目录项"  />
</p>
<ul>
<li><code>key</code>：为页中最小的主键值</li>
<li><code>page_no</code>：页号</li>
</ul>
<p>目录项称为索引。</p>
<h4 id="inndb中索引方案">InnDB中索引方案<a hidden class="anchor" aria-hidden="true" href="#inndb中索引方案">#</a></h4>
<h5 id="迭代1次-目录项记录的页">迭代1次-目录项记录的页<a hidden class="anchor" aria-hidden="true" href="#迭代1次-目录项记录的页">#</a></h5>
<p><img loading="lazy" src="image-8.png" alt="迭代1次-目录项记录的页"  />
</p>
<p>目录项记录和普通用户记录区别：</p>
<ol>
<li>record_type目录项记录为1，普通为2</li>
<li>目录项记录页只有两项，普通由用户定义</li>
<li>（了解）记录头信息中有<code>min_rec_mask</code>属性，只有目录项记录页中为1，别的都为0</li>
</ol>
<p>相同点：</p>
<ol>
<li>都是同样的数据页，都用页目录，都可以用二分加快查找速度</li>
</ol>
<h5 id="迭代2次-多个目录项记录的页">迭代2次-多个目录项记录的页<a hidden class="anchor" aria-hidden="true" href="#迭代2次-多个目录项记录的页">#</a></h5>
<p><img loading="lazy" src="image-9.png" alt="迭代2次-多个目录项记录的页"  />
</p>
<p>IO最多加载很多次。</p>
<h5 id="迭代3次-目录项记录页的目录页">迭代3次-目录项记录页的目录页<a hidden class="anchor" aria-hidden="true" href="#迭代3次-目录项记录页的目录页">#</a></h5>
<p><img loading="lazy" src="image-10.png" alt="迭代3次-目录项记录页的目录页"  />
</p>
<p>IO最多加载3次。</p>
<p>用图来描述</p>
<p><img loading="lazy" src="image-11.png" alt="B&#43;树"  />
</p>
<p>这个数据结构，称为<strong>B+树</strong>。</p>
<p>B+树通常不超过4层<br>
原因：层数越低，IO次数越少。4层所容纳的记录很庞大，4层以上没有必要。</p>
<h3 id="常见索引概念">常见索引概念<a hidden class="anchor" aria-hidden="true" href="#常见索引概念">#</a></h3>
<h4 id="聚簇索引">聚簇索引<a hidden class="anchor" aria-hidden="true" href="#聚簇索引">#</a></h4>
<p>据此索引不是单独的索引类型，而是<strong>一种数据存储方式</strong>，所有用户记录保存在叶子节点，所谓<strong>索引即数据，数据即索引</strong>。</p>
<p>特点：</p>
<ol>
<li>记录和页排序方向：
<ul>
<li>页内：按主键大小顺序排成<strong>单向链表</strong></li>
<li>用户记录页：按页内主键大小顺序排成<strong>双向链表</strong></li>
<li>目录项记录页：页内外都是通过主键大小顺序排成<strong>双向链表</strong></li>
</ul>
</li>
<li>叶子节点存储完整的用户数据</li>
</ol>
<p>添加数据的时候，底层自动构建聚簇索引</p>
<p>优点：</p>
<ol>
<li>数据访问更快</li>
<li>主键排序查找和范围查找速度块</li>
<li>节省大量IO操作</li>
</ol>
<p>缺点：</p>
<ol>
<li>插入速度严重依赖于插入顺序</li>
<li>更新主键值代价很高</li>
<li>二级索引需要两次索引查找，第一次找主键，第二次找数据</li>
</ol>
<p>限制：</p>
<ol>
<li>只有InnDB支持聚簇索引</li>
<li>如没有定义主键，InnDB会选择非空的唯一索引代替，如果没有InnDB会隐式定义一个主键。</li>
<li>InnDB表主键尽量选用有序的顺序Id，不建议用无需，无法宝珠主键数据的顺序长度。</li>
</ol>
<h4 id="二级索引辅助索引非聚簇索引">二级索引（辅助索引、非聚簇索引）<a hidden class="anchor" aria-hidden="true" href="#二级索引辅助索引非聚簇索引">#</a></h4>
<p><img loading="lazy" src="image-12.png" alt="二级索引"  />
</p>
<p>非主键字段做索引，把主键做记录，对每个非主键字段都做一次索引。</p>
<p>在通过非主键查询整个记录的时候，再通过查找到的c1主键回到聚簇索引查找其他字段的操作叫<strong>回表</strong>。</p>
<p><img loading="lazy" src="image-13.png" alt="回表"  />
</p>
<p>聚簇索引于非聚簇索引原理不同，使用也有区别：</p>
<ol>
<li>聚簇索引的<code>叶子节点</code>存储的是<code>数据记录</code>，非聚簇索引叶子节点是<code>数据位置</code>，非聚簇索引不会影响数据表的物理存储顺序。</li>
<li>一个表<code>只能由一个聚簇索引</code>，因为只能有一种排序储存的方式，但是可以有<code>多个非聚簇索引</code>，也就是多个索引目录提供数据检索。</li>
<li>使用聚簇索引，数据<code>查询效率高</code>，但是插入、删除、更新操作效率比非聚簇索引低。</li>
</ol>
<h4 id="联合索引">联合索引<a hidden class="anchor" aria-hidden="true" href="#联合索引">#</a></h4>
<p>两个字段进行联合索引，在c2相同的时候，按照c3的顺序排列。</p>
<p><img loading="lazy" src="image-14.png" alt="联合索引"  />
</p>
<h3 id="innodb的b树索引的注意事项">InnoDB的B+树索引的注意事项<a hidden class="anchor" aria-hidden="true" href="#innodb的b树索引的注意事项">#</a></h3>
<h4 id="根位置万年不动">根位置万年不动<a hidden class="anchor" aria-hidden="true" href="#根位置万年不动">#</a></h4>
<p>在实际的B+树生成过程中是由上而下创建的。</p>
<ul>
<li>最初的时候只有一层根页面。</li>
<li>插入数据，当跟页面空间用完的时候，对根页面中的数据复制到新的数据页A内，然后对新页A进行<strong>页分裂</strong>得到新页B，这时新插入的数据根据顺序插入到新页A或者新页B。最后把根页面升级为存储目录项记录的页。</li>
</ul>
<p>根节点从始至终都存在，不会移动。</p>
<h4 id="内节点中目录项记录的唯一性">内节点中目录项记录的唯一性<a hidden class="anchor" aria-hidden="true" href="#内节点中目录项记录的唯一性">#</a></h4>
<p>在非聚簇索引中举例：<br>
<img loading="lazy" src="image-15.png" alt="目录项记录的唯一性"  />
</p>
<p>构建二级索引：<br>
<img loading="lazy" src="image-16.png" alt="构建二级索引"  />
</p>
<p>当要插入新数据：c1：9、c2：1、c3：&lsquo;p&rsquo;的时候，我们无法判断是在页4添加还是页5添加。没法保持唯一性。</p>
<p>解决办法把主键添加进去：<br>
<img loading="lazy" src="image-17.png" alt="添加主键"  />
</p>
<p>这样通过c1和c2就可以唯一的确定位置。</p>
<h4 id="一个页面最少存储2条记录">一个页面最少存储2条记录<a hidden class="anchor" aria-hidden="true" href="#一个页面最少存储2条记录">#</a></h4>
<p>一个B+树只需要很少的层级就可以轻松存储数亿条记录，查询速度很快。</p>
<h2 id="myisam中的索引方案">MyISAM中的索引方案<a hidden class="anchor" aria-hidden="true" href="#myisam中的索引方案">#</a></h2>
<p><img loading="lazy" src="image-18.png" alt="MyISAM中的索引方案"  />
</p>
<p>Memory默认采用Hash索引。MyISAM和InnoDB默认采用B+树索引。</p>
<p>MyISAM引擎使用B+树作为索引结构，叶子节点的data域存放<code>数据记录的地址值</code></p>
<h3 id="myisam索引的原理">MyISAM索引的原理<a hidden class="anchor" aria-hidden="true" href="#myisam索引的原理">#</a></h3>
<p>MyISAM数据和索引分开存储。</p>
<p>原理图：<br>
<img loading="lazy" src="image-19.png" alt="MyISAM索引的原理图"  />
</p>
<p>在Col2上建立一个二级索引，则此索引的结构如下图所示： <br>
<img loading="lazy" src="image-20.png" alt="Col2上建立二级索引"  />
</p>
<h3 id="myisam与innodb对比">MyISAM与InnoDB对比<a hidden class="anchor" aria-hidden="true" href="#myisam与innodb对比">#</a></h3>
<p><font color=red><strong>MyISAM中索引方式都是非聚簇的，与InnoDB包含1个聚簇索引是不同的</strong></font></p>
<ul>
<li>InnoDB中需要根据主键值对聚簇索引进行一次查找就能找到记录，MyISAM中却需要进行一次<strong>回表</strong>操作，所以MyISAM中的索引都是<strong>二级索引</strong>。</li>
<li>InnoDB数据本身也是索引，MyISAM中索引文件和数据文件分开存储，索引仅存储数据地址值。</li>
<li>InnoDB的非聚簇索引data域存储相应的主键值，而MyISAM索引记录的是<strong>地址</strong>。</li>
<li>MyISAM因为data域存储的是地址值，所以在进行回表操作的时候非常快。InnoDB则需要先获取主键，然后再去聚簇索引里找记录，没有MyISAM迅速。</li>
<li>InnoDB要求必须有主键，而MyISAM可以没有，如果没有，MySQL洗头膏会自动选择一个字段做主键，如果不存在符合条件的字段，则生成隐含字段做主键。</li>
</ul>
<p><img loading="lazy" src="image-21.png" alt="对比图"  />
</p>
<h2 id="索引的代价">索引的代价<a hidden class="anchor" aria-hidden="true" href="#索引的代价">#</a></h2>
<ul>
<li>
<p>空间上的代价</p>
<p>只要创建索引，就会创建数据页，一个页默认16KB，会占用很大一片存储空间</p>
</li>
<li>
<p>时间上的代价</p>
<p>每次对表中数据进行增删改，都要去修改B+树索引，增加了维护B+树的时间成本。</p>
</li>
</ul>
<blockquote>
<p>一个表上索引越多，占用空间就越大，增删改性能就越差，索引我们要学会在哪些地方合理的使用索引。</p>
</blockquote>
<h2 id="mysql数据结构选择的合理性">MySQL数据结构选择的合理性<a hidden class="anchor" aria-hidden="true" href="#mysql数据结构选择的合理性">#</a></h2>
<p>归根结底就是<strong>减少对磁盘I/O的操作次数，提升效率</strong>。</p>
<h3 id="全表遍历">全表遍历<a hidden class="anchor" aria-hidden="true" href="#全表遍历">#</a></h3>
<p>顺序遍历查找</p>
<h3 id="hash结构">Hash结构<a hidden class="anchor" aria-hidden="true" href="#hash结构">#</a></h3>
<p>Hash本身是一个函数，又称散列函数，可以帮助我们大幅提升检索数据效率</p>
<p>相同的输入永远可以得到相同的输出。</p>
<p><strong>Hash结构效率高，那为什么索引要设计成树</strong><br>
原因1：Hash索引只能满足等值查询，对范围查询时间复杂度还是O(n)</p>
<p>原因2：Hash索引数据的存储是没有顺序的，在Order by情况下，使用Hash索引还需要进行排序</p>
<p>原因3：对于联合查询，hash值相加有可能出现相同的情况</p>
<p>原因4：对于等值查询，如果出现类似性别的情况，重复太多，那么hash碰撞就很频繁。</p>
<p><img loading="lazy" src="image-22.png" alt="Hash索引"  />
</p>
<p>Hash索引的适用性：<br>
<img loading="lazy" src="image-23.png" alt="Hash索引的适用性"  />
<br>
采用自适应 Hash 索引目的是方便根据 SQL 的查询条件加速定位到叶子节点，特别是当 B+ 树比较深的时候，通过自适应 Hash 索引可以明显提高数据的检索效率。</p>
<h3 id="二叉搜索树">二叉搜索树<a hidden class="anchor" aria-hidden="true" href="#二叉搜索树">#</a></h3>
<p><img loading="lazy" src="image-24.png" alt="二叉搜索树"  />
</p>
<p>极端情况<br>
<img loading="lazy" src="image-25.png" alt="Alt text"  />
</p>
<p>时间复杂度退化到了O(n)。</p>
<h3 id="avl树">AVL树<a hidden class="anchor" aria-hidden="true" href="#avl树">#</a></h3>
<p>又称<strong>平衡二叉树</strong>。左右节点高度差不超过1</p>
<p><img loading="lazy" src="image-26.png" alt="AVL树"  />
</p>
<p>针对同样的数据，如果我们把二叉树改成<code>M 叉树</code>（M&gt;2）呢？当 M=3 时，同样的 31 个节点可以由下面的三叉树来进行存储：</p>
<p><img loading="lazy" src="image-27.png" alt="M叉树"  />
</p>
<p>为了提高查询效率，就需要<strong>减少磁盘IO数</strong>。为了减少磁盘IO的次数，就需要尽量<strong>降低树的高度</strong>，需要把原来“瘦高”的树结构变的“矮胖”，树的每层的分叉越多越好。</p>
<h3 id="b-tree">B-Tree<a hidden class="anchor" aria-hidden="true" href="#b-tree">#</a></h3>
<p>结构图：</p>
<p><img loading="lazy" src="image-28.png" alt="B-Tree"  />
</p>
<p><strong>B 树相比于平衡二叉树来说磁盘 I/O 操作要少</strong>，在数据查询中比平衡二叉树效率要高。所以<strong>只要树的高度足够低，IO次数足够少，就可以提高查询性能</strong>。</p>
<p>举例1：</p>
<p><img loading="lazy" src="image-29.png" alt="B树举例"  />
</p>
<h3 id="btree">B+Tree<a hidden class="anchor" aria-hidden="true" href="#btree">#</a></h3>
<p>基于B树做出了改进，更适合文件索引系统。</p>
<p>B+树与B树的差异：</p>
<ol>
<li>有k个孩子节点就有k个关键字，孩子数=关键字数，而B数，孩子数=关键字数+1</li>
<li>非叶子节点的关键字也会存在在叶子节点，并且是在子节点中所有关键字的最大或最小</li>
<li>非叶子节点仅用于索引，不保存数据记录，跟记录有关的信息都放在叶子节点。B树中，非叶子节点既保存数据又保存索引。</li>
<li>所有关键字都在叶子节点出现，叶子节点构成双向有序链表，叶子节点本身按照关键字大小从小到大顺序链接。</li>
</ol>
<blockquote>
<p><strong>思考</strong></p>
<p>为了减少IO，索引会一次性加载吗？</p>
<ol>
<li>数据库索引是储存在磁盘上的，如果数据量很大，必然导致索引很大。</li>
<li>当我们利用索引查询时，不可能全部加载，只能逐一加载每个磁盘页，因为磁盘页对应着索引树的节点。</li>
</ol>
<p>B+树能力如何，为什么说一般查找行记录，只要1-3次磁盘IO</p>
<ol>
<li>B+树中储存页标准16kb，我们主键INT为4字节，BIGINT为8字节，指针类型一般也为4-8字节。那么一个储存也就可以存储<code>16kb/(8b+8b)=1k</code>个键值，估算下来如果B+树为3层结构，那么就是<code>1k * 1k * 1k = 10亿</code>条记录，非常庞大。</li>
<li>实际情况每个节点不一定填满，因此B+树高度一般为2-4层，所以如果有4层那么第四层到根节点最多也就3次IO。</li>
</ol>
<p>为什么说B+树比B-树更适合实际应用中操作系统的文件索引和数据库索引？</p>
<ol>
<li>B+树磁盘读写代价更低</li>
<li>B+树的查询效率更加稳定</li>
</ol>
</blockquote>
<h3 id="r树">R树<a hidden class="anchor" aria-hidden="true" href="#r树">#</a></h3>
<p>了解</p>
<h1 id="2-innodb数据存储结构">2. InnoDB数据存储结构<a hidden class="anchor" aria-hidden="true" href="#2-innodb数据存储结构">#</a></h1>
<h2 id="数据库的储存结构页">数据库的储存结构：页<a hidden class="anchor" aria-hidden="true" href="#数据库的储存结构页">#</a></h2>
<p>索引储存在页结构里，索引是在储存引擎中实现的。不同引擎存放格式不同。</p>
<p><strong>InnoDB是MySQL默认存储引擎</strong>。</p>
<h3 id="磁盘与内存交互基本单位页">磁盘与内存交互基本单位：页<a hidden class="anchor" aria-hidden="true" href="#磁盘与内存交互基本单位页">#</a></h3>
<p>InnoDB将数据划分为若干个页，InnoDB中页的大小默认为<code>16KB</code></p>
<p>页是磁盘与内存之间交互的<strong>基本单位</strong>。一次最少从磁盘中读取16KB内容到内存中。一次最少把内存中的16KB内容刷新到磁盘中。</p>
<p><strong><font color=red>数据库管理存储空间的基本单位是页（Page），数据库I/O操作的最小单位是页。</font></strong></p>
<p><img loading="lazy" src="image-30.png" alt="存储单位页"  />
</p>
<h3 id="页结构概述">页结构概述<a hidden class="anchor" aria-hidden="true" href="#页结构概述">#</a></h3>
<p>页<strong>不在物理结构上相连</strong>，只需通过<strong>双向链表</strong>关联即可。</p>
<p>数据页中每条记录按照主键值从小到大顺序组成<strong>单向链表</strong>。</p>
<p>每个数据页都会储存的记录生成<strong>页目录</strong>。</p>
<p>通过主键查找记录，可以在页目录中使用<strong>二分法</strong>快速定位。</p>
<h3 id="页的大小">页的大小<a hidden class="anchor" aria-hidden="true" href="#页的大小">#</a></h3>
<p>在MySQL的InnoDB引擎中，默认页大小为16KB。</p>
<h3 id="页的上层结构">页的上层结构<a hidden class="anchor" aria-hidden="true" href="#页的上层结构">#</a></h3>
<p>页的上层结构有区、段、表空间。</p>
<p><img loading="lazy" src="image-31.png" alt="页的上层结构"  />
</p>
<ul>
<li>区：比页大一级，一个区分配64个连续页，区大小为<code>64*16KB=1MB</code></li>
<li>段：由一个或多个连续区组成，区是连续分配的空间。段时数据库中的分配单位，不同类型的数据库对象以不同的段形式存在。</li>
<li>表空间：一个表空间可以有一个或多个段。表空间从管理上可以划分为<code>系统表空间、用户表空间、撤销表空间、临时表空间</code> 等。</li>
</ul>
<h2 id="页的内部结构">页的内部结构<a hidden class="anchor" aria-hidden="true" href="#页的内部结构">#</a></h2>
<p>常见：<strong>数据页（保存B+树节点） 、系统页、Undo页和事务数据页</strong></p>
<p>数据页被分为7个部分：<br>
<img loading="lazy" src="image-32.png" alt="数据页"  />
</p>
<p>7部分作用：<br>
<img loading="lazy" src="image-33.png" alt="数据页作用"  />
</p>
<h3 id="第一部分file-header文件头和file-trailer文件尾">第一部分：File Header（文件头）和File Trailer（文件尾）<a hidden class="anchor" aria-hidden="true" href="#第一部分file-header文件头和file-trailer文件尾">#</a></h3>
<h4 id="文件头部38字节">文件头部（38字节）<a hidden class="anchor" aria-hidden="true" href="#文件头部38字节">#</a></h4>
<p>作用： 描述各种页的通用信息（如页编号、下一页信息）</p>
<table>
<thead>
<tr>
<th style="text-align:left">名称</th>
<th style="text-align:center">占用空间大小</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>FIL_PAGE_SPACE_OR_CHKSUM</code></td>
<td style="text-align:center">4字节</td>
<td style="text-align:left">页的校验和（checksum值）</td>
</tr>
<tr>
<td style="text-align:left"><code>FIL_PAGE_OFFSET</code></td>
<td style="text-align:center">4字节</td>
<td style="text-align:left">页号</td>
</tr>
<tr>
<td style="text-align:left"><code>FIL_PAGE_PREV </code></td>
<td style="text-align:center">4字节</td>
<td style="text-align:left">上一个页的页号</td>
</tr>
<tr>
<td style="text-align:left"><code>FIL_PAGE_NEXT</code></td>
<td style="text-align:center">4字节</td>
<td style="text-align:left">下一个页的页号</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_LSN</td>
<td style="text-align:center">8字节</td>
<td style="text-align:left">页面被最后修改时对应的日志序列位置</td>
</tr>
<tr>
<td style="text-align:left"><code>FIL_PAGE_TYPE </code></td>
<td style="text-align:center">2字节</td>
<td style="text-align:left">该页的类型</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_FILE_FLUSH_LSN</td>
<td style="text-align:center">8字节</td>
<td style="text-align:left">仅在系统表空间的一个页中定义，代表文件至少被刷新到了对应的LSN值</td>
</tr>
<tr>
<td style="text-align:left"><code>FIL_PAGE_ARCH_LOG_NO_OR_SPACE_ID</code></td>
<td style="text-align:center">4字节</td>
<td style="text-align:left">页属于哪个表空间</td>
</tr>
</tbody>
</table>
<p><code>FIL_PAGE_OFFSET</code>：记录页的编号。</p>
<p><code>FIL_PAGE_TYPE</code>：当前页类型。如下：</p>
<table>
<thead>
<tr>
<th style="text-align:left">类型名称</th>
<th style="text-align:center">十六进制</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">FIL_PAGE_TYPE_ALLOCATED</td>
<td style="text-align:center">0x0000</td>
<td style="text-align:left">最新分配，还没有使用</td>
</tr>
<tr>
<td style="text-align:left"><code>FIL_PAGE_UNDO_LOG</code></td>
<td style="text-align:center">0x0002</td>
<td style="text-align:left">Undo日志页</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_INODE</td>
<td style="text-align:center">0x0003</td>
<td style="text-align:left">段信息节点</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_IBUF_FREE_LIST</td>
<td style="text-align:center">0x0004</td>
<td style="text-align:left">Insert Buffer空闲列表</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_IBUF_BITMAP</td>
<td style="text-align:center">0x0005</td>
<td style="text-align:left">Insert Buffer位图</td>
</tr>
<tr>
<td style="text-align:left"><code>FIL_PAGE_TYPE_SYS</code></td>
<td style="text-align:center">0x0006</td>
<td style="text-align:left">系统页</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_TYPE_TRX_SYS</td>
<td style="text-align:center">0x0007</td>
<td style="text-align:left">事务系统数据</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_TYPE_FSP_HDR</td>
<td style="text-align:center">0x0008</td>
<td style="text-align:left">表空间头部信息</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_TYPE_XDES</td>
<td style="text-align:center">0x0009</td>
<td style="text-align:left">扩展描述页</td>
</tr>
<tr>
<td style="text-align:left">FIL_PAGE_TYPE_BLOB</td>
<td style="text-align:center">0x000A</td>
<td style="text-align:left">溢出页</td>
</tr>
<tr>
<td style="text-align:left"><code>FIL_PAGE_INDEX</code></td>
<td style="text-align:center">0x45BF</td>
<td style="text-align:left">索引页，也就是我们所说的<code>数据页</code></td>
</tr>
</tbody>
</table>
<h3 id="第二部分空闲空间用户记录和最小最大记录">第二部分：空闲空间、用户记录和最小最大记录<a hidden class="anchor" aria-hidden="true" href="#第二部分空闲空间用户记录和最小最大记录">#</a></h3>
<h1 id="3-索引的创建与设计原则">3. 索引的创建与设计原则<a hidden class="anchor" aria-hidden="true" href="#3-索引的创建与设计原则">#</a></h1>
<h2 id="31-索引的声明与使用">3.1 索引的声明与使用<a hidden class="anchor" aria-hidden="true" href="#31-索引的声明与使用">#</a></h2>
<h3 id="索引的分类">索引的分类<a hidden class="anchor" aria-hidden="true" href="#索引的分类">#</a></h3>
<ul>
<li>功能逻辑：普通索引、唯一索引、主键索引、全文索引</li>
<li>物理实现方式：聚簇索引、非聚簇索引</li>
<li>作用字段：单列索引、联合索引</li>
</ul>
<p>不同存储引擎支持的索引类型不一样</p>
<h3 id="创建索引">创建索引<a hidden class="anchor" aria-hidden="true" href="#创建索引">#</a></h3>
<h4 id="1在建表的时候创建索引">1）在建表的时候创建索引<a hidden class="anchor" aria-hidden="true" href="#1在建表的时候创建索引">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> dept(
</span></span><span style="display:flex;"><span>    dept_id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> AUTO_INCREMENT, <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">主键索引</span>
</span></span><span style="display:flex;"><span>    dept_name VARCHAR(<span style="color:#ae81ff">20</span>)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emp(
</span></span><span style="display:flex;"><span>    emp_id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> AUTO_INCREMENT,
</span></span><span style="display:flex;"><span>    emp_name VARCHAR(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">UNIQUE</span>,    <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">唯一索引</span>
</span></span><span style="display:flex;"><span>    dept_id INT,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">CONSTRAINT</span> emp_dept_id_fk <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>(dept_id) <span style="color:#66d9ef">REFERENCES</span> dept(dept_id) <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">外键索引</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>显示创表时创建索引，基础语法</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">table_name</span> [col_name data_type]
</span></span><span style="display:flex;"><span>[<span style="color:#66d9ef">UNIQUE</span> <span style="color:#f92672">|</span> FULLTEXT <span style="color:#f92672">|</span> SPATIAL] [<span style="color:#66d9ef">INDEX</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">KEY</span>] [index_name] (col_name [<span style="color:#66d9ef">length</span>]) [<span style="color:#66d9ef">ASC</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">DESC</span>]
</span></span></code></pre></div><ul>
<li><code>UNIQUE</code>、<code>FULLTEXT</code>和<code>SPATIAL</code>为可选参数，分别表示唯一索引、全文索引和空间索引；</li>
<li><code>INDEX</code> 与 <code>KEY</code> 为同义词，两者的作用相同，用来指定创建索引；</li>
<li><code>index_name</code> 指定索引的名称，为可选参数，如果不指定，那么MySQL默认col_name为索引名；</li>
<li><code>col_name</code> 为需要创建索引的字段列，该列必须从数据表中定义的多个列中选择；</li>
<li><code>length</code>为可选参数，表示索引的长度，只有字符串类型的字段才能指定索引长度；</li>
<li><code>ASC</code> 或 <code>DESC</code> 指定升序或者降序的索引值存储。</li>
</ul>
<h4 id="2创建普通索引">2）创建普通索引<a hidden class="anchor" aria-hidden="true" href="#2创建普通索引">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> book(
</span></span><span style="display:flex;"><span>    book_id INT ,
</span></span><span style="display:flex;"><span>    book_name VARCHAR(<span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">`</span>authors<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>    info VARCHAR(<span style="color:#ae81ff">100</span>) ,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">`</span><span style="color:#66d9ef">comment</span><span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">100</span>),
</span></span><span style="display:flex;"><span>    year_publication <span style="color:#66d9ef">YEAR</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">INDEX</span>(year_publication) <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">普通索引</span>
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><h4 id="3创建唯一索引">3）创建唯一索引<a hidden class="anchor" aria-hidden="true" href="#3创建唯一索引">#</a></h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> test1(
</span></span><span style="display:flex;"><span>    id INT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    NAME VARCHAR(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">UNIQUE</span> <span style="color:#66d9ef">INDEX</span> uk_idx_id(id) <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">使用</span>id作为唯一索引
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>使用<code>SHOW CREATE TABLE</code>查看表结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">FROM</span> test1;
</span></span></code></pre></div><p><img loading="lazy" src="image-34.png" alt="查询表结构"  />
</p>
<h4 id="4主键索引">4）主键索引<a hidden class="anchor" aria-hidden="true" href="#4主键索引">#</a></h4>
<p>设定为主键后<strong>数据库自动建立索引</strong>，<code>innodb</code>为聚簇索引</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> student (
</span></span><span style="display:flex;"><span>    id INT(<span style="color:#ae81ff">10</span>) UNSIGNED AUTO_INCREMENT ,
</span></span><span style="display:flex;"><span>    student_no VARCHAR(<span style="color:#ae81ff">200</span>),
</span></span><span style="display:flex;"><span>    student_name VARCHAR(<span style="color:#ae81ff">200</span>),
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(id)
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">FROM</span> student;
</span></span></code></pre></div><p><img loading="lazy" src="image-35.png" alt="主键索引查看"  />
</p>
<p>删除主键索引</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> student
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>;
</span></span></code></pre></div><p>有概率会出现特殊情况<br>
<img loading="lazy" src="image-36.png" alt="删除主键索引特殊情况"  />
</p>
<p>因主键有自动递增，需要先删除自动递增约束</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> student <span style="color:#66d9ef">MODIFY</span> id INT(<span style="color:#ae81ff">10</span>) UNSIGNED;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> student <span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>;
</span></span></code></pre></div><h1 id="4-性能分析工具的使用">4. 性能分析工具的使用<a hidden class="anchor" aria-hidden="true" href="#4-性能分析工具的使用">#</a></h1>
<h1 id="5-索引优化与查询优化">5. 索引优化与查询优化<a hidden class="anchor" aria-hidden="true" href="#5-索引优化与查询优化">#</a></h1>
<h1 id="6-数据库设计规范">6. 数据库设计规范<a hidden class="anchor" aria-hidden="true" href="#6-数据库设计规范">#</a></h1>
<h1 id="7-数据库其它调优策略">7. 数据库其它调优策略<a hidden class="anchor" aria-hidden="true" href="#7-数据库其它调优策略">#</a></h1>


        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://zhoujze.github.io/en/posts/mysql/01-mysql%E6%9E%B6%E6%9E%84%E7%AF%87/">
    <span class="title">« 上一页</span>
    <br>
    <span></span>
  </a>
  <a class="next" href="https://zhoujze.github.io/en/posts/mysql/03-mysql%E4%BA%8B%E5%8A%A1%E7%AF%87/">
    <span class="title">下一页 »</span>
    <br>
    <span></span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share  on twitter"
       href="https://twitter.com/intent/tweet/?text=&amp;url=https%3a%2f%2fzhoujze.github.io%2fen%2fposts%2fmysql%2f02-mysql%25E7%25B4%25A2%25E5%25BC%2595%25E8%25B0%2583%25E4%25BC%2598%25E7%25AF%2587%2f&amp;hashtags=">
    <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share  on linkedin"
       href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fzhoujze.github.io%2fen%2fposts%2fmysql%2f02-mysql%25E7%25B4%25A2%25E5%25BC%2595%25E8%25B0%2583%25E4%25BC%2598%25E7%25AF%2587%2f&amp;title=&amp;summary=&amp;source=https%3a%2f%2fzhoujze.github.io%2fen%2fposts%2fmysql%2f02-mysql%25E7%25B4%25A2%25E5%25BC%2595%25E8%25B0%2583%25E4%25BC%2598%25E7%25AF%2587%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share  on reddit"
       href="https://reddit.com/submit?url=https%3a%2f%2fzhoujze.github.io%2fen%2fposts%2fmysql%2f02-mysql%25E7%25B4%25A2%25E5%25BC%2595%25E8%25B0%2583%25E4%25BC%2598%25E7%25AF%2587%2f&title=">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share  on facebook"
       href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fzhoujze.github.io%2fen%2fposts%2fmysql%2f02-mysql%25E7%25B4%25A2%25E5%25BC%2595%25E8%25B0%2583%25E4%25BC%2598%25E7%25AF%2587%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share  on whatsapp"
       href="https://api.whatsapp.com/send?text=%20-%20https%3a%2f%2fzhoujze.github.io%2fen%2fposts%2fmysql%2f02-mysql%25E7%25B4%25A2%25E5%25BC%2595%25E8%25B0%2583%25E4%25BC%2598%25E7%25AF%2587%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share  on telegram"
       href="https://telegram.me/share/url?text=&amp;url=https%3a%2f%2fzhoujze.github.io%2fen%2fposts%2fmysql%2f02-mysql%25E7%25B4%25A2%25E5%25BC%2595%25E8%25B0%2583%25E4%25BC%2598%25E7%25AF%2587%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

        </footer>
    </div>

<style>
    .comments_details summary::marker {
        font-size: 20px;
        content: '👉展开评论';
        color: var(--content);
    }
    .comments_details[open] summary::marker{
        font-size: 20px;
        content: '👇关闭评论';
        color: var(--content);
    }
</style>


<div>
    
    <script src="https://cdn.staticfile.org/twikoo/1.4.11/twikoo.all.min.js">
    </script>
    <script>
        twikoo.init({
            envId:  null ,
        el: "#tcomment",
            lang: 'zh-CN',
            region:  null ,
        path: window.TWIKOO_MAGIC_PATH||window.location.pathname,
        })
    </script>
</div>
</article>
</main>

<footer class="footer">
    <span>
        Copyright
        &copy;
        2023-2023
        <a href="https://zhoujze.github.io/en/" style="color:#939393;">ZhouJz&#39;s blog</a>
        All Rights Reserved
    </span>
    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;"></a>&nbsp;
    <span>
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=null"
           style="display:inline-block;text-decoration:none;height:20px;color:#939393;">
            <img src="" style="float:left;margin: 0px 5px 0px 0px;"/>
            
        </a>
    </span>
    <span id="busuanzi_container">
        <span class="fa fa-user"></span> <span id="busuanzi_value_site_uv"></span>
        <span class="fa fa-eye"></span> <span id="busuanzi_value_site_pv"></span>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"ZhouJz's blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\n————————————————\r\n' +
                    '版权声明：本文为「'+"ZhouJz's blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = '📄复制';

        function copyingDone() {
            copybutton.innerText = '👌🏻已复制!';
            setTimeout(() => {
                copybutton.innerText = '📄复制';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\n————————————————\r\n' +
                    '版权声明：本文为「'+"ZhouJz's blog"+'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>
</body>

</html>
